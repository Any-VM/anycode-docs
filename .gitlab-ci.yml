before_script:
  - apt-get update -qq
  - apt-get install -qq git
  # Setup SSH deploy keys
  - "which ssh-agent || ( apt-get install -qq openssh-client )"
  - eval $(ssh-agent -s)
  - echo "$SSH_PRIVATE_KEY"
  - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
  - mkdir -p ~/.ssh
  - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'

deploy_staging:
  script:
    - ssh $SSH_HOST "export NODE_OPTIONS=--max-old-space-size=8192;
      cd /var/www/anycode-docs && git pull && pnpm i;
      /root/.local/share/pnpm/pm2 stop anycode-docs;
      pnpm build;
      /root/.local/share/pnpm/pm2 start anycode-docs"
  only:
    - main
